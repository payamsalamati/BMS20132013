# Polarion SW Requirement Table #
 
In the tables below, the SW Polarion Requirements are linked to the implemented modules.


### Heizung (CB-9846) ###
|  Polarion ID/Link | Description | Used SW module | Further information |
|--------|--------|:--------------:|:--------:|
| [CB-8638](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-8638) | Das BMS muss eine Software-Schnittstelle zur Integration des Heizungsalgorithmuses bereitstellen. | --- | Not Applicable Accepted|
| [CB-16323](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-16323) | The Battery-Management-System shall support the Heating-System.| --- | High Level requirement can not be implemented by SW.|
| [CB-16324]( https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-8638) | The Battery-Management-System shall implement a 'Heating Control Function' that controls the heating system (turn on & turn off) upon request of the heating algorithm and returns a feedback value of the actual state of the heating system. | heating.h | --- |

### Spannungsmessung (CB-9864) ###
|  Polarion ID/Link | Description | Used SW module | Further information |
|--------|--------|:--------------:|:--------:|
| [CB-16336](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-16336) | The Battery-Management-System shall implement a battery voltage measurement. | highVoltageMeasurement.h | --- |
| [CB-16337](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-16337) | The voltage measurement rate shall be at least 100Hz.| highVoltageMeasurement_mainFunction() called every 10ms in safetyTask.c (safetyCycle()) | --- |

### Temperaturmessung (CB-10735) ###
|  Polarion ID/Link | Description | Used SW module | Further information |
|--------|--------|:--------------:|:--------:|
| [CB-4627](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-4627) | Der Messwert soll über CAN zugänglich sein. (Anmerkung: Siehe Verlinkung zu BMS Data.) Der Messwert soll als Input Parameter für das Histogramm dienen. (Anmerkung: Siehe Verlinkung zu Histogrammen.) Der Messwert soll als Input Paramter für DTCs dienen. (Anmerkung: Siehe Verlinkung zu DTC Data) | --- | Not Applicable Accepted |
| [CB-8525](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-8525) | Die vom BMS Slave gemessene Temperatur am Modulverbinder soll nicht der Gruppe "Zelltemepartur" zugeordnet werden (alternative Zuordnung z.B. "Verbindertemperatur). Beispielhafte Umsetzung hierzu siehe WH BMS. | --- | Not Applicable Draft |
| [CB-8584](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-8584) | Der BMS Master muss über CAN folgende Temperaturen auslesen können: Temperaturwert des Bremswiderstands (BCM)Temperaturwert am Modulverbinder (BMS CS)  | --- | Not Applicable Draft |
| [CB-10094](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10094) | NTC_Config	ntcSensorResistor	10000; ntcSensorsupplyVoltage	5000; ntcSensorminTemp	-40; ntcSensormaxTemp	105; ntcSensorSize	146; ntcSensorMapInOhm | --- | Clarification Necessary |
| [CB-10095](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10095) | Name	NTCSensorMap; Map DID	0x200E, 0x200F; Unit X-Axis (horiziontal)	T/°C; Unit Y-Axis (data)	R/Ohm | --- | Clarification Necessary |
| [CB-10096](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10096) | Temperature/resistance graph (see link) | --- | Clarification Necessary |
| [CB-10097](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10097) | The BMS shall interpolate between points of the datamap. Outside of the datamap the BMS shall use the nearest/last value from the datamap. | --- | Clarification Necessary |
| [CB-10098](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10098) | Temperatue/resistance table (see link) | --- | Clarification Necessary |
| [CB-10099](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10099) | ntcSensorMapInOhm; ntcSensorminTemp	ntcSensorMapInOhm[0]; ntcSensorminTemp + 1	ntcSensorMapInOhm[1]; ntcSensorminTemp + 2	ntcSensorMapInOhm[2]; ntcSensorminTemp + 3	ntcSensorMapInOhm[3]; ….; ntcSensormaxTemp	ntcSensorMapInOhm[ntcSensorSize] | --- | Clarification Necessary |

### CAN (CB-9811) ###
|  Polarion ID/Link | Description | Used SW module | Further information |
|--------|--------|:--------------:|:--------:|
| [CB-4926](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-4926) | Im Falle eines Busfehlers (Bus-OFF) muss die Komponente eine Reinitialisierung des CAN-Controllers durchführen. Der Sender prüft seinerseits, ob der CAN-Transceiver die Nachricht binnen der letzten Rasterzeit auf dem Bus erfolgreich absetzen konnte. Anderenfalls liegt ein Sende-Fehler vor. In diesem Fall setzt das sendende Steuergerät die Kommunikation auf Pre-Operational zurück und sendet anschließend keine PDOs mehr bis es wieder neu in das Netzwerk eingebunden wurde. | --- |  TODO |
| [CB-7868](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-7868) | Das BMS Master muss die folgenden CAN-Kommunikationsschnittstellen mit 500 kbaud konfigurieren: CAN_1 CAN_2 CAN_3 | --- |  Not Applicable Accepted |
| [CB-8578](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-8578) | Sensor_CAN / Internal 1: CAN 2.0 Protokoll; Flashen der CPS über UDS (BMS Master als Gateway) usw. | --- |  Not Applicable Accepted |
| [CB-10802](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10802) | The following settings shall be used for CAN bus bit-timing for buses operating at 250 kbit/s and 500 kbit/s (see also System Design Specification 253569, chapter 5.4 "physical signaling"): baud rate tolerance: ± 100 ppm, i.e. ± 0.01 %; sampling mode:  1 sample per bit;synchronization: signal transitions from recessive to dominant only; number of time quanta:  10 - 20; sampling point: 85 % - 90 % (recommended: 87.5 %); synchronization jump width (SJW):   <= TSEG2 | --- |  Draft |
| [CB-10803](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10803) | If multiple possibilities exist for adjusting the bit-timing parameters inside the abovementioned limits, the sampling point shall be as small as possible and the number of time quanta as large as possible. | --- |  Draft |
| [CB-10804](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10804) | SJW shall always be set to the largest possible value that is still smaller or equal to TSEG2. | --- |  Draft |
| [CB-10805](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10805) | The ECU supplier shall provide information for KION about the chosen bit-timing parameters. | --- |  Draft |
| [CB-10815](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10815 ) | The hardware acceptance filter for received CAN messages shall be configured as restrictive as possible while still letting pass all necessary messages. test | --- |  Draft |
| [CB-11192](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-11192 ) | Message counter errors shall also lead to a DTC entry 0x5XXX07 "alive/sequence counter incorrect/not updated" (see System Design Specification 117817). | --- |  Draft |
| [CB-11539](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-11539) | All ECUs which are connected to a CAN bus shall support the following minimum diagnostic features to detect potential errors of the CAN bus system:'bus off' errors; message counter or message checksum errors; signal errors; message timeouts | --- |  TODO |
| [CB-16218](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-16218) | The Battery-Management-Systemshall comply with the can bus related error handling requirements as specified in [2] excluding the exceptions specified in [1].| --- |  TODO |
| [CB-16229](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-16229) | The Battery-Management-Systemshall comply with the can bus and protocol related error handling requirements as specified in [3].| --- |  TODO |

### CANopen SDO (CB-9808) ###
|  Polarion ID/Link | Description | Used SW module | Further information |
|--------|--------|:--------------:|:--------:|
| [CB-72906](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-72906) | The following SDO services shall be used by SDO clients and servers: <br>For writeable object indices <br> - Initiate SDO Download         (CCS=1, SCS=3)<br>- Download SDO Segment     (CCS=0, SCS=1) <br>For readable object indices<br> - Initiate SDO Upload           (CCS=2, SCS=2) <br>- Upload SDO Segment        (CCS=3, SCS=0) | sdo.h |   |
| [CB-11222](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-11222)  | Size Indicator <br> SDO servers shall accept SDO services with both "size indicator = 0" and "size indicator = 1". SDO clients shall always use "size indicator = 1". | --- | Not Applicable Draft |
|  [CB-11655](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-11655) | All CANopen nodes which support the SDO protocol (client or server) shall implement timeout monitoring for SDO messages for all supported types of SDO transfers.| ---  | Not Applicable Draft |
|  [CB-11656](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-11656)|SDO timeout monitoring shall be implemented according to the CANopen standard. | ---  | Not Applicable Draft |
|  [CB-11657](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-11657) | The default timeout limit for CANopen SDO messages can be found in the chapter "SDO Services". | ---  | Further information |
|  [CB-16212](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-16212)  |The Battery-Management-System shall send CANopen SDO, Emergency and Heartbeat messages as specified in [2]. | Used SW module |  |
|  [CB-16213](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-16213)  |The Battery-Management-System shall receive and evaluate CANopen SDO, Time, Module Control and Heartbeat messages as specified in [2] | Used SW module |  |
| [CB-16216](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-16216)  | The Battery-Management-System shall comply with the CANopen SDO message requirements as specified in [2]. | Used SW module |  |

### CANopen (CB-9812) ###
| Polarion ID/Link | Description | Used SW module | Further information |
|--------|--------|:--------------:|:--------:|
| [CB-10963](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10963) | A node shall have a NMT state on each CANopen CAN-bus on which it communicates. | nmt.c |  |
| [CB-10965](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10965) | A node shall support the following CANopen NMT states: 0x00: bootup, 0x05: operational, 0x7F: pre-operational | canOpenStm_types.h canOpen_State_t |  |
| [CB-10966](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10966) | A node should support the CANopen NMT state 0x04 “stopped”. | canOpenStm_types.h canOpen_State_t |  |
| [CB-10967](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10967) | If a node supports the NMT state 0x04 “stopped”, the state itself and all state transitions from and to the state shall be implemented as specified in the CANopen standard. | canOpenNodeStm.c |  |
| [CB-10970](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10970) | A node (master or slave) shall perform state transitions ((2), (15) and (16) of System Design Specification 228841) automatically as soon as the actions associated with the former state are completed (dashed lines in the diagram). | canOpenNodeStm.c |  |
| [CB-10971](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10971) | The CANopen NMT state of a node shall only be used to describe the network communication state of a node. There is no direct relationship between the NMT state and the overall node or ECU state. | canOpenNodeStm.c |  |
| [CB-10975](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10975) | A node shall send the boot-up message (heartbeat with NMT state 0x00) for its main CANopen node ID on transition (2) of System Design Specification 228841 o indicate that it has entered NMT state “pre-operational” for the first time after boot-up or reset. | canOpenNodeStm.c |  |
| [CB-72650](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-72650) | A node shall start sending its periodic CANopen heartbeat message as soon as it has sent its boot-up message. | kionCANSend40() |  |
| [CB-10986](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10986) | The heartbeat producer time shall also apply for the time between the boot-up message and the first non-boot-up heartbeat. | canSendTask.c |  |
| [CB-10988](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10988) | A node shall publish its NMT state (see chapter “CANopen Network Management States”) in the CANopen heartbeat message of its main CANopen node ID on each CANopen CAN-bus to which it is connected. | canSendTask.c |  |
| [CB-10989](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10989) | If a node has additional node IDs (e.g. for additional PDO messages, additional SDO connections, etc.), it shall not send heartbeat messages for those additional node IDs. |  | Not Applicable Draft |
| [CB-72658](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-72658) | A node shall only send NMT states in its heartbeat message which are specified in the CANopen standard. |  kionCAN_preparelib_heartbeat() |  |
| [CB-10992](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10992) | A node shall be able to send plausible CANopen signal values if its ECU supply voltage is in the voltage range for CAN communication after the startup phase described in chapter “Startup and Boot-up Message”. |  | Not Applicable Draft |
| [CB-10994](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10994) | A node shall be able to perform CANopen communication without interruption or disturbance irrespective of other node-internal activities, tasks or operating modes. | taskAlavieMonitor.c |  |
| [CB-11015](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-11015) | An NMT slave node shall automatically enter NMT state “pre-operational” after startup, as is described in chapter “CANopen Network Management – Startup and Boot-Up Message”. | canOpenNodeStm.c |  |
| [CB-11016](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-11016) | An NMT slave node shall wait for NMT service requests from the NMT master as soon as it has entered NMT state “pre-operational”. | nmt.c CanOpenNodeStm.c |  |
| [CB-11034](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-11034) | An NMT slave node shall support the following CANopen NMT services: 0x01: start remote node, 0x80: enter pre-operational, 0x81: reset node, 0x82: reset communication | nmt.c |  |
| [CB-11035](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-11035) | If an NMT slave node supports NMT state 0x04 “stopped”, it shall support the NMT service 0x02 “stop remote node”. | nmt.c |  |
| [CB-11038](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-11038) | An NMT slave node shall support all its supported NMT services both if the request was addressed at the node’s main CANopen node ID and if it was addressed at node ID 0x00 (all nodes). | nmt.c | |
| [CB-11039](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-11039) | An NMT slave node shall ignore requests for NMT services which are addressed neither at its main CANopen node ID nor at node ID 0x00 (all nodes). | nmt.c |  |
| [CB-11045](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-11045) | If an NMT slave node receives an NMT service request to change its NMT state, it shall send all CANopen messages which belong to the previous/old NMT state no more than once after receiving the NMT service request. | kionCAN_send.c |  |
| [CB-11050](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-11050) | If an NMT slave node receives an NMT service request to change its NMT state, it shall no longer send CANopen messages which belong to the previous/old NMT state after it has published its new NMT state in its heartbeat message. | kionCAN_send.c |  |
| [CB-11052](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-11052) | If an NMT slave node receives an NMT service request 0x81 “reset node”, it shall first stop sending any CANopen messages, then perform the reset and then restart sending the heartbeat message (first with NMT state 0x00 “boot-up”). | CanOpenNodeStm.c KionStateMachine.c |  |
| [CB-11054](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-11054) | The duration from the NMT service request 0x81 “reset node” until the NMT slave node sends the “boot-up” message after the reset shall be no more than 3 s. | KionStateMachine.c | has to be approved by tests |
| [CB-11055](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-11055) | If an NMT slave node receives an NMT service request 0x82 “reset communication”, it shall first stop sending any CANopen messages, then re-initialize its communication drivers and then restart sending the heartbeat message (first with NMT state 0x00 “boot-up”). | CanOpenNodeStm.c |  |
| [CB-11056](Https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-11056) | The duration from the NMT service request 0x82 “reset communication” until the NMT slave node sends the “boot-up” message after re-initializing the communication drivers shall be no more than tSTARTUP_PROCESS (see chapter “General ECU Behavior - Startup”). | not tested |  |
| [CB-11057](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-11057) | If an NMT slave node receives an NMT service request 0x01 “start remote node” or 0x80 “enter pre-operational” while performing an SDO transfer, it shall continue the SDO transfer irrespective of the state transition. | nmt.c sdo.c |  |
| [CB-74754](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-74754) | The LIB shall ignore CANopen network management commands "start remote node" for any of its slave node IDs until one of the CAN protocols was selected. | nmt.c canopen_config.c |  |
| [CB-13824](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-13824) | The LIB shall accept any CANopen network management command other than "start remote node" at any time. | nmt.c |  |

### CAN (CB-9814) ###
| Polarion ID/Link | Description | Used SW module | Further information |
|--------|--------|:--------------:|:--------:|
| [CB-4523](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-4523) | Kion diagnostic protocol (for application and bootloader)  | - | Not Applicable Accepted|
| [CB-6179](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-6179) | Ein Hochlauf wird für die LIB vom CANopen Master (Fahzeug/Ladegerät) gesteuert. siehe separate PTC Spezifikationen: | - | Not Applicable Accepted |
| [CB-8470](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-8470) | The CANopen slave node ID of the <LIB_CB> shall be either 0x27 (new KION CAN protocol) or 0x0D (old Linde Counterbalance CAN protocol) or 0x3C (old Still Counterbalance protocol). | - | -> Protokoll Erkennung CB-9813|
| [CB-8473](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-8473) | After the <LIB_CB> has entered CANopen pre-operational state, it shall wait until the CANopen master selects one of the CAN protocols by performing an SDO upload or download of the object "nominal battery voltage". | in sdo_writeTable the object will be written, Bevore that no CAN-Messages are send out | - |
| [CB-8589](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-8589) | Das BMS Master steuert den Hochlauf der Batterie über den CANopen Master. | - | Not Applicable Draft |
| [CB-10777](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10777) | A malfunction of the ECU shall not disturb communication of the remaining ECUs that are also connected to the CAN bus network. | - | Change Request |
| [CB-10778](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10778) | The ECU shall not disturb communication of the remaining ECUs while its supply voltage is off or not within the specified operating voltage range (for example during engine start). | - | Cannot be testet in the SW |
| [CB-10779](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10779) | The ECU shall not disturb communication of the remaining ECUs if its ground connection fails. | - | Cannot be testet in the SW |
| [CB-10780](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10780) | The ECU shall not disturb communication of the remaining ECUs while its microcontroller or CAN-module resets and/or initializes (after the initial startup or reset). | - | Cannot be testet in the SW |
| [CB-10781](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10781) | CAN bus malfunctions shall not interfere with the remaining functions of the ECU. Functions which use CAN bus messages or signals for their correct operation shall fall back into a fail-safe state. Local functions (that don’t use CAN bus messages or signals) should continue. | - | Change Request |
| [CB-10800](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10800) | In any way, the ECU supplier shall prove to KION that the requirements for the CAN bus clock tolerance will be met when considering the whole clock generation process and the operating conditions as specified in section "General Information". | - | Change Request |
| [CB-10947](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10947) | If an ECU detects inconsistent non-safety-related data in its non-volatile memory, it should restore the data to the last known consistent state. | - | Change Request |
| [CB-11017](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-11017) | NMT slave nodes shall support arbitrary initialization sequences, i.e. any combination and order of NMT service requests and/or SDO transfers (within the possibilities of CANopen) or no commands at all. | ??? | Draft and B3 |
| [CB-11027](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-11027) | If an NMT slave node can shut itself off at will (e.g. by a special power supply circuit, relay, etc.) or enter some form of sleep mode, it shall do so only in NMT state “pre-operational”. | ??? | Draft and B3|
| [CB-11126](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-11126) | Bits which are not occupied by a signal shall be set to 1 by the sender (see "signal not available" in System Design Specification 117324). | ??? | Further information |
| [CB-11307](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-11307) | This object shall represent the "Consumer heartbeat time 1" object as specified by the CANopen standard. |- | Not Applicable Draft |
| [CB-11308](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-11308) | A CANopen master shall download this object to all of its slaves after startup in order to configure its own master node ID in the slave. | - | Not Applicable Draft |
| [CB-11311](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-11311) | The object [consumer_heartbeat_time_1] shall use object index 0x1016, subindex 0x01. | - | Not Applicable Draft |
| [CB-11312](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-11312) | The data type and encoding of the object shall be as specified in the CANopen standard. | - | Not Applicable Draft |
| [CB-11313](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-11313) | The object shall be readable and writeable by SDO clients. | - |  Not Applicable Draft |
| [CB-11314](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-11314) | Valid values for the [consumer_heartbeat_time_1] shall be: | - | Not Applicable Draft |
| [CB-11316](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-11316) | The [consumer_heartbeat_time_1] shall be 0x00000000 after bootup (i.e. no master heartbeat configured). |- |  Not Applicable Draft |
| [CB-11625](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-11625) | A CANopen slave shall use object [consumer_heartbeat_time_1] to determine the node ID of its CANopen master (and thus the message ID that shall be monitored). | - | Not Applicable Draft |
| [CB-74933](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-74933) | Message: [lib_pdo_tx8] | - | Draft and planned in FuelCell_CR |
| [CB-74978](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-74978) | Signal: [lib_soc_without_soh_fine] | kionCAN_sendLib_pdo_tx6 | Draft |
| [CB-74980](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-74980) | Signal: [lib_min_temperature] | kionCAN_sendLib_pdo_tx6 | Draft |
| [CB-74981](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-74981) | Signal: [lib_max_temperature] | kionCAN_sendLib_pdo_tx6 | Draft |
| [CB-14242](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-14242) | Signal: [lib_current_unfiltered] | - | Draft and planned in FuelCell_CR |
| [CB-14244](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-14244) | Signal: [lib_voltage_in_front_of_contactor_unfiltered] | - | Draft and planned in FuelCell_CR |
| [CB-14246](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-14246) | Signal: [lib_voltage_after_contactor_unfiltered] |- | Draft and planned in FuelCell_CR  |
| [CB-74999](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-74999) | Message: [lib_pdo_rx1]    * ID: 0x227 | Used SW module | Clarification Necessary |
| [CB-75000](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-75000) | Message: [lib_pdo_rx4]    * ID: 0x527 | kionCAN_config.c| Draft Completed |
| [CB-75010](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-75010) | Signal: [lib_charging_current]  | kionCAN_receive | Draft Completed |
| [CB-75011](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-75011) | Signal: [lib_charging_voltage] | kionCAN_receive | Draft Completed |
| [CB-75012](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-75012) | Signal: [lib_charging_power]  | kionCAN_receive | Draft Completed |
| [CB-75014](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-75014) | signal: [lib_truck_operating_hours] | kionCAN_receive | Draft Completed |
| [CB-75015](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-75015) | Signal: [lib_truck_operating_hours_mode] | kionCAN_receive | Draft Completed |
| [CB-75095](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-75095) | [lib_fatal_error] | kionCAN_preparelib_pdo_tx1 | Reviewed |
| [CB-75096](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-75096) | [lib_temperature_too_low] |kionCAN_preparelib_pdo_tx1 | Reviewed |
| [CB-75097](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-75097) | [lib_temperature_too_high] |kionCAN_preparelib_pdo_tx1 | Reviewed |
| [CB-14358](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-14358) | [lib_service_required] | - | Not Applicable Draft |
| [CB-75099](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-75099) | [lib_temperature] | kionCAN_preparelib_pdo_tx1 | Reviewed |
| [CB-75105](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-75105) | [lib_min_discharging_voltage] | kionCAN_preparelib_pdo_tx3 | Reviewed |
| [CB-75111](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-75111) | [lib_max_charging_voltage] | kionCAN_preparelib_pdo_tx4 | Reviewed |
| [CB-75127](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-75127) | [truck_operating_hours]  The KWPC will provide appropriate information in this signal depending on the signal [operating_hours_mode]. | nothing todo here? | Reviewed |
| [CB-75128](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-75128) | [truck_operating_hours_mode] The LIB will receive information about the operating hours mode in addition to the signal [operating_hours] via this signal. The LIB shall store the following operating hours dependent on the operating hour mode (a) for the truck with mode key switch (0x1) and (b) for the charger with mode LIB charger operating hours (0x8) independently.  | canData_storeLastLibPdoRx4Data | data are not stored independly from each other |
| [CB-16201](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-16201) | The Battery-Management-System shall communicate via CAN Bus with the Truck, Charger, Tester and Balancer. |  - | TODO B3  |
| [CB-16202](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-16202) | The Battery-Management-System shall support multiple CAN process communication protocols. | - | TODO B3 |
| [CB-16206](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-16206) | The implementation of the New KION CAN protocol shall be implemented according to [1] and [2]. | High Level Requirement |  |
| [CB-16207](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-16207) | The Battery-Management-System shall support the New KION CAN protocol. | High Level Requirement | - |
| [CB-16208](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-16208) | The Battery-Management-System shall provide the CANopen object dictionary as specified in [1] and [2]. | High Level Requirement  | - |
| [CB-16214](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-16214) | The Battery-Management-System shall comply with the general CANopen network requirements and the requirements for CANopen NMT slaves as specified in [2]. | High Level Requirement | - |

### Stromsensor Kommunikation & Spannungsversorgung (CB-9848) ###
|  Polarion ID/Link | Description | Used SW module | Further information |
|--------|--------|:--------------:|:--------:|
| [CB-10245](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10245) | [ICD038] If the configuration of the ICD current sensor fails, the BMS shall set the DTC “DTC_ICD_CONFIGURATION_INVALID”. The detection of a configuration shall be debounced, therefore the fault shall be set if three consecutive configuration attempts have failed to successfully transmit a configuration. | icdaSensor_config.h, icdaSensor.c |  TODO DTC in Polarion anlegen [GitIssue](https://gitlab.futavis.de/futavis/system/architektur/cb-bms/-/issues/64)|
| [CB-10246](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10246) | [ICD037] There shall be diagnostic routine “RID_ICD_Reset”. The routine is only available in ExtendedDiagnosticSession or DevelopmentSession. RoutineControlType: startRoutine; RoutineControlOption: reset_option (uint8); The RoutineControlOption refers to the signal <ICD_Request::Request> as specified in [1]. | uds_routineControl_config.c |  TODO Verarbeitung von response |
| [CB-10247](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10247) | [ICD036] There shall be diagnostic routine “RID_ICD_ClearStatus”. The routine is only available in ExtendedDiagnosticSession or DevelopmentSession. RoutineControlType: startRoutine; The RoutineControlOption refers to the signal <ICD_Request::ClearStatus> as specified in [1]. | uds_routineControl_config.c |  TODO Verarbeitung von response |
| [CB-10248](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10248) | [ICD035] There shall be a diagnostic routine “RID_ICD_ClearEventCounter”. The routine is only available in ExtendedDiagnosticSession or DevelopmentSession. RoutineControlType: startRoutine; The RoutineControlOption refers to the signal <ICD_Request::ClearEventCounter> as specified in [1].| uds_routineControl_config.c |  TODO Verarbeitung von response |
| [CB-10249](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10249) | [ICD031] There shall be a parameter “PARAM_ICD_DeviceID” that includes the device ID of the sensor. This parameter is part of the DID “DID_ICD_Identification”. Info: This parameter refers to the signal <ICD_Response::DeviceID> as specified in [1].| --- |  TODO B2 |
| [CB-10250](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10250) | [ICD030] There shall be a DID “DID_ICD_Identification” that includes identification data of the ICD current sensor. The DID shall be readable during all Sessions including DefaultSession.| --- |  TODO B2 |
| [CB-10251](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10251) | [ICD034] There shall be diagnostic routine “RID_ICD_EventCounter”. The routine is available in all sessions including DefultSession. RoutineControlType: startRoutine; RoutineControlOption: - measurement_status (uint8); - system_status (uint8); - The RoutineControlOption refers to the signal <ICD_Request::EventCounter> as specified in [1].| uds_routineControl_config.c |  TODO Verarbeitung von response |
| [CB-10252](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10252) | [ICD033] There shall be a parameter “PARAM_ICD_FWVersion” that includes the firmware version of the sensor. This parameter is part of the DID “DID_ICD_Identification”. Info: This parameter refers to the signal <ICD_Response::FWVersion> as specified in [1].| --- | TODO B2 |
| [CB-10253](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10253) | [ICD032] There shall be a parameter “PARAM_ICD_SerialNumber” that includes the serial number of the sensor. This parameter is part of the DID “DID_ICD_Identification”. Info: This parameter refers to the signal <ICD_Response::SerialNumber> as specified in [1].| --- | TODO B2  |
| [CB-10254](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10254) | The electrical integration of the current into the battery system is described in the block diagram referenced in [2]. The ICD Current Sensor communicates with the Battery-Management-System via CAN Bus. There are no additional IO interfaces. The power supply of the ICD is provided by the BMS.| --- |  High Level requirement can not be implemented by SW. |
| [CB-10255](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10255) | The current sensor provides additional information during startup or upon request as specified in [1]. (see link)| --- |  Milestone not defined |
| [CB-10256](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10256) | The communication interface of the ICD current sensor consists out of three CAN messages as specified in [1]. (see link)| icdaCAN_config.c | --- |
| [CB-10257](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10257) | [ICD028] There shall be a parameter “PARAM_ICD_Temperature” that includes the temperature measurement result of the sensor. This parameter is part of the DID “DID_ICD_Diagnostic_Information”. Info: This parameter refers to the signal <ICD_Response::Temperature> as specified in [1].| icdaSensor.c | TODO add DID_ICD_Diagnostic_Information |
| [CB-10258](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10258) | [ICD027] There shall be a parameter “PARAM_ICD_Status_Bits” that includes the sensor status. This parameter is part of the DID “DID_ICD_Diagnostic_Information”. Info: This parameter refers to the signal <ICD_Response::Status> as specified in [1].| icdaSensor.c | TODO add DID_ICD_Diagnostic_Information |
| [CB-10259](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10259) | [ICD026] There shall be a DID “DID_ICD_Diagnostic_Information” that includes all ICD current sensor diagnostic information. The DID shall be readable during all Sessions including DefaultSession.| Temporary added to new Table hb12 - 0x00 | TODO add DID_ICD_Diagnostic_Information in polarion |
| [CB-10260](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10260) | [ICD025] There shall be a parameter “PARAM_ICD_Average_Value” that defines the averaging value of the current measurement as specified in [1]. This parameter is part of the DID “DID_ICD_Configuration”. Info: This parameter refers to the signal <ICD_Request::SetAveraging>.| icdaSensor.c (MEM_SEC_PARAMETER ICDASensor_Config icdaSensorConfig); Temporary added to new Table hb12 - 0x00  | TODO define DID_ICD_Configuration in polarion|
| [CB-10261](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10261) | [ICD029] There shall be a parameter “PARAM_ICD_Lifetime” that includes the lifetime counter of the sensor. This parameter is part of the DID “DID_ICD_Diagnostic_Information”. Info: This parameter refers to the signal <ICD_Response::Lifetime> as specified in [1].| --- | Milestone not defined, wie und wann genau soll “PARAM_ICD_Lifetime” ausgelesen weerden? |
| [CB-10262](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10262) | [ICD023] The configuration of ICD sensor shall be: Operating Mode: 0x01 – continuous; Output Rate: according to functional safety concept, but max. 5ms; Current Direction: “PARAM_ICD_Current_Direction”; Average Value: “PARAM_ICD_Average_Value”;OC Limit: - charge current according to “PARAM_Peak_CH_Current_TH2”, - discharge current according to “PARAM_Peak_DCH_Current_TH2”, - the assignment of positive and negative direction shall be according to “PARAM_Current_Interpretation”; Info: The output rate shall be specified as part of the functional safety concept. The parameters “PARAM_Peak_CH_Current_TH2”, “PARAM_Peak_CH_Current_TH2” and “PARAM_Current_Interpretation” refer to the DIDs 0x4E1B, 0x4E1F and 0x420E.| init done in icdaSensor.c Default parameter in icdaSensor_config.h  | TODO DIDs anlegen |
| [CB-10263](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10263) | [ICD024] If the parameter “PARAM_Current_Sensor_Config” is set to the value 5 an ICD current sensor is being connected to the BMS. This parameter shall be used to enable/activate all ICD related software functions (as specified in this document), when an ICD current sensor is part of the battery system and vice versa. Info: The parameter “PARAM_Current_Sensor_Config” refers to the DID 0x4205. | icdaSensorConfig.PARAM_Current_Sensor_Config can enable/disable alle ICD related functions(icdaSensor.c, canSendTask. & canReceiveTask.c) | --- |
| [CB-10267](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10267) | [ICD020] The BMS shall configure the current sensor with the correct configuration as described in [CB-10262](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10262)  . | icdaSensor.c | --- |
| [CB-10271](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10271) | [ICD022] If the configuration of the ICD current sensor is not correct, the BMS shall configure the sensor with the correct settings. Info: in case the configuration is not possible this means there is a continuous repletion of configuration attempts. | --- | TODO Direkte Configuration des ICD beim startup ist schneller und vermeidet unnötigen Traffic auf dem CAN. Wird geklärt um Req notwendig https://gitlab.futavis.de/futavis/software/futavis-bms/cbbms/-/issues/74#note_171891 |
| [CB-10272](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10272) | [ICD021] The BMS shall check the current configuration of the current sensor during each startup. | --- | TODO Direkte Configuration des ICD beim startup ist schneller und vermeidet unnötigen Traffic auf dem CAN. Wird geklärt um Req notwendig https://gitlab.futavis.de/futavis/software/futavis-bms/cbbms/-/issues/74#note_171891 |
| [CB-10285](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10285) | [ICD003] The BMS shall evaluate the CAN signal <ICD_Result::Current> cyclically as measurement value for the battery current. | icdaSensor.c | --- |
| [CB-10286](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10286) | [ICD041] If there is a “measurement error” sensor fault, the BMS shall set the DTC “DTC_ICD_SENSOR_MEASUREMENT_FAULT”. Info: the faults are communicated in the status message of <ICD_Result>. | icdaSensor.c | TODO DTC in Polarion anlegen [GitIssue](https://gitlab.futavis.de/futavis/system/architektur/cb-bms/-/issues/64)|
| [CB-10287](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10287) | [ICD002] The BMS shall read the CAN signal <ICD_Result::Counter> cyclically and evaluate it for communication fault monitoring.| icdaSensor.c | --- |
| [CB-10289](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10289) | [ICD001] The BMS shall read the CAN signal <ICD_Result::Status> cyclically and evaluate it for sensor fault monitoring.| icdaSensor.c | --- |
| [CB-10290](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10290) | [ICD039] If there is a communication loss with the ICD, the BMS shall set the DTC “DTC_ICD_COM_FAULT”. The communication loss detection shall be debounced. Info: The debouncing shall be aligned with the function safety concept.| icdaSensor.c (running watchdog for max ICDA_MAX_CYCLE_TIME = 100) | --- |
| [CB-10291](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10291) | [ICD044] The transmission rate for the Current Sensor CAN shall be 500kBit/s.| can_config.h | --- |
| [CB-10294](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10294) | [ICD045] The BMS shall read the CAN signal <ICD_Response::AhCounter> cyclically and evaluate it for cycle counting and State-of-Charge estimation.| cyclially read in icdaSensor.c (get value using uint32_t icdaSensor_getAhCounter(void)) | --- |
| [CB-10296](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10296) | [ICD004] The BMS shall evaluate the CAN signal <ICD_Result::Voltage> cyclically as power supply value for the ICD current sensor.| cyclially read in icdaSensor.c (get value using uint16_t icdaSensor_getSupplyVoltageMeasurements(void)) | --- |
| [CB-10297](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10297) | [ICD043] Info: The OCS status of the ICD current sensor shall be ignored by any monitoring functions, that are not functional safety relevant. During the operation in the truck the battery currents may exceed the nominal measurement range. Currents in the overcurrent measurement range shall not lead to any faults, as long as there is no functional safety relevance.| icdaSensor.c, icdaSensor_config.h | --- |
| [CB-10298](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10298) | [ICD042] If there is a “system error” sensor fault, the BMS shall set the DTC “DTC_ICD_SENSOR_SYSTEM_FAULT”. Info: the faults are communicated in the status message of <ICD_Result>.| icdaSensor.c | TODO DTC in Polarion anlegen [GitIssue](https://gitlab.futavis.de/futavis/system/architektur/cb-bms/-/issues/64) |
| [CB-16309](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-16309) | The Battery-Management-System shall support the current sensors of Isabellenhütte ICD and IVT product lines. | --- | TODO B1? Wie genau ist das definiert? Es gibt sonst keinerlei IVT Anfoderungen |
| [CB-16310](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-16310) | The type of current sensor that is being used shall be configurable in the BMS software.  | --- | TODO B3 |
| [CB-16311](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-16311) | The Battery-Management-System shall comply with the software requirements for the ICD current sensor integration as specified in [23].  | --- | TODO B3 |
| [CB-16312](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-16312) | The Battery-Management-System shall also comply with the software requirements for the IVT current sensor integration, which are analog to those of the ICD sensor.   | --- | TODO B3 |
| [CB-10268](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10268) | [ICD019] The BMS shall request to clear the status bits of the ICD current sensor using the signal <ICD_Request::ClearStatus>, whenever a new error is reported in the message <ICD_Result>. If the error does not disappear the BMS shall repeat the request after 2000ms. The BMS shall not try to clear the status more than 3 times for each newly reported fault.  | icdaSensor.c| --- |
| [CB-10269](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10269) | [ICD018] The BMS shall request a reset of the ICD current sensor using the signal <ICD_Request::Reset>, whenever the reset is required by a diagnostic service. The reset option as specified by [1] shall be handed over by the diagnostic service. | uds_routineControl_config.c (startRoutineICDreset()) | --- |
| [CB-10270](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10270) | [ICD017] The BMS shall request to clear the status bits of the ICD current sensor using the signal <ICD_Request::ClearStatus> whenever the clearing is required by a diagnostic service. | uds_routineControl_config.c (startRoutineICDClearStatus()) | --- |


### Contactor control and Statemachine (CB-9848) ###
|  Polarion ID/Link | Description | Used SW module / Function | Further information |
|--------|--------|:--------------:|:--------:|
|[CB-10021](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10021) |There shall be a parameter “PARAM_S2_Precharge_Method” that defines the pre-charge mechanism for the contactor S2.|StmConfig in stateFunctions.h||
|[CB-10022](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10022) |There shall be a DID  “DID_S2_Precharge_Configuration” that includes all S2 pre-charge related parameters / configurations. The DID shall be readable during all Sessions including DefaultSession, but only be writeable during DevelopmentSession.|Shall be done by XCP | - |
|[CB-10034](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10034) | The BMS shall implement a voltage based and a time based closing mechanism (pre-charge mechanism) for the contactors S1 and S2.| Closing Contactor Routine at kionStatemachine.c ||
|[CB-10035](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10035) |The contactor control function is responsible for the closing and opening sequence of the contactors S1 and S2.| pwmRelaisIf_controlRelay ||
|[CB-10051](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10051) |The contactors are controlled with an external PWM. The contactors shall be driven according to [2].|pwmRelaisIf_controlRelay ||
|[CB-10053](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10053) |The closing and opening sequence shall be implemented according to [4].|Closing/Opening Contactor Routine at kionStatemachine ||
|[CB-16331](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-16331) |The Battery-Management-System shall implement the contactor control specified in [33] and [34].|  kionStatemachine |  |
|[CB-16330](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-16330) |According to the requirements in section 4 the Battery-Management-System shall monitor the state of the contactors and shall initiate suitable measures in case of implausibilities.| auxRelayMonitor_mainFunction |  |
|[CB-10024](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10024) |The Battery-Management-System shall validate the state of the auxiliary contact of any contactor immediately after it was opened as specified in [4].| kionStatemachine |  |
|[CB-10025](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10025) |There shall be a parameter “PARAM_S2_Precharge_Timeout” that defines the timeout threshold for the voltage based pre-charge. The resolution shall be in [ms] and the range 0ms – 10000ms.| StmConfig in stateFunctions |  |
|[CB-10026](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10026) |There shall be a parameter “PARAM_S2_Precharge_Condition” that defines the voltage ratio for the voltage-based pre-charge. The resolution shall be [0.5%] and the range 0%-100%.| StmConfig in stateFunctions |  |
|[CB-10028](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10028) |	The Battery-Management-System shall differentiate between two contactor mounting positions (“PARAM_Contactor_Preference_Direction”): <br>       S1: Preference Direction Charge; S2: Preference Direction Discharge <br>      S1: Preference Direction Discharge; S2: Preference Direction Charge| ContactorPrefenceDirection in stateFunctions  |  |
|[CB-10050](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10050) |There shall be a parameter “PARAM_S2_Precharge_Time” that defines the time delay for the time based pre-charge. The resolution shall be in [ms] and the range 0ms – 10000ms.| StmConfig in stateFunctions |  |
|[CB-10052](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10052) |The closing mechanisms for the contactors S1 and S2 shall be configurable over UDS and parameter flashfile.| StmConfig is  configurable|  only over XCP |
|[CB-10059](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10059) |There shall be a parameter “PARAM_Contactor_Preference_Direction” that defines the contactors preferred current direction for the opening of the contactor. This parameter shall be added to the “DID_Contactor_Configuration” (0x4204).| uds_writeData_config.h | can't be configured by UDS |
|[CB-10029](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10029) |The battery current used for the evaluation must always refer to the value of the corresponding battery current data object (DID 0x400E)| -  |  - |
|[CB-10030](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10030) | The Battery-Management-System shall dynamically adapt the order in which the contactors are opened, depending on the direction of the battery current (charge or discharge current) as well as depending on the contactor mounting direction (“PARAM_Contactor_Preference_Direction”).| open Contactors Routine in kionStatemachine at kionStatemachine |  - |
|[CB-10031](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10031) |The condition for the electrical load is given when the absolute battery current is less than a threshold for a minimum time.| - | - |
|[CB-10045](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10045) |In case there is an active CAN timeout to the CANopen master, the Battery-Management-System shall proceed with the opening of the contactors only if there is no electrical load on the battery.| kionStatemachine | - |
|[CB-10046](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10046) |The Battery-Management-System shall check whether there is an active CAN timeout to the CANopen master before opening any contactor.| kionStatemachine | - |
|[CB-9981](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-9981) |Diagramm| open Contactors Routine in kionStatemachine | - |
|[CB-10023](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10023)| The Battery-Management-System shall change its state once the opening of the contactors was successful. In case of a fault the state-change shall be induced by the respective fault handling mechanism.| errorStm | - |
|[CB-10033](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10033)| The closing mechanisms for the contactors S1 and S2 shall be independent.| close Contactors Routine in kionStatemachine |  |
|[CB-10037](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10037)| For the voltage based mechanism the contactor S2 shall be closed when the voltage ratio  is above the defined threshold (“PARAM_S2_Precharge_Condition”) within the specified time (“PARAM_S2_Precharge_Timeout”).| close Contactors Routine in kionStatemachine |  |
|[CB-10039](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10039)| The Battery-Management-System shall close the contactor S2 based on the configured mechanism (“PARAM_S2_Precharge_Method”). Info: The configuration of the mechanism is part of the DID “DID_S2_Precharge_Configuration”..| close Contactors Routine in kionStatemachine |  |
|[CB-10041](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10041)| The Battery-Management-System shall only close the contactor S2, when the validation of the auxiliary contact of the contactor S1 was successful.| close Contactors Routine in kionStatemachine |	|
|[CB-10044](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10044)| TThe DTC “DTC_CONTACTOR_PRE_CHARGE_TIMEOUT_S2” DTC_PRECHARGE_TIMEOUT shall be set, when the voltage ratio did not exceed the threshold <Image: clip_image002.gif> (“PARAM_S2_Precharge_Condition”) within the defined time <Image: clip_image004.gif> (“PARAM_S2_Precharge_Timeout”).| close Contactors Routine in kionStatemachine |  |
|[CB-10047](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10047)| 	For the time based mechanism the contactor S2 shall be closed after a set delay time (“PARAM_S2_Precharge_Time”).| close Contactors Routine in kionStatemachine | - |
|[CB-10054](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10054)|  	The Battery-Management-System shall close the contactor S1 immediately (time based mechanism), whenever the component BCM is not part of the battery-system (“PARAM_BCM_Available”). | close Contactors Routine in kionStatemachine |  |
|[CB-10056](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10056)| The voltage based mechanism for contactor S1 is specified in [5] as the pre-charge mechanism for the BCM component.| - | CBM module is not supported in B1 |
|[CB-10058](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10058)|The Battery-Management-System shall close the contactor S1 based on the voltage ratio (voltage based mechanism), whenever the component BCM part of the battery-system (“PARAM_BCM_Available”).| - | CBM module is not supported in B1  |
|[CB-9982](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-9982)| Diagramm| close Contactors Routine in kionStatemachine  | - |
|[CB-10042](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10042)|The Battery-Management-System shall set the DTC “DTC_CONTACTOR_OPEN_FAULT”, DTC_CONTACTOR_DIAG_ERROR when a feedback the corresponding aux signal indicates that the opening of any contactor was not successful.| open Contactor routine in kionStatemachine | - |
|[CB-10043](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10043)| The state of the auxiliary contact of contactor S1 shall immediately be validated after it was closed.| close Contactor routine in kionStatemachine| - |
|[CB-10049](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10049)| Any input information or measurement values that are required for checks or verifications during the contactor control sequences must always be up-to-date. That means the data shall not be older than 50 ms. |  |measurements will be done every 10ms
|[CB-10057](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-10057)| The DTC “DTC_CONTACTOR_CLOSE_FAULT_S1” DTC_CONTACTOR_DIAG_ERROR  shall be set, when the feedback signal of S1 indicates that the closing of S1 was not successful as determined by the state of the auxiliary contacts.| close contactor Routine in kionStatemachine | - |
|[CB-19022](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-19022)| Das BMS muss vor dem Zuschalten prüfen, dass die AUX Kontakte der Schütze dem geöffneten Zustand entsprechen.| close contactor Routine in kionStatemachine | - |
|[CB-16329](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-16329)| The Battery-Management-System shall detect malfunctions (e.g. problems with power supply of the BMS like short-term interruptions or short-term over- or undervoltage) and shall open the contactors according to the requirements in section 4.| kionStatemachine | - |
|[CB-15084](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-15084)| The BMS must read the input signal <CPS_BMS_WakeUp>. A high value of the signal <CPS_BMS_WakeUp> indicates that the wakeup source is the CPS (emergency wakeup). A low value of the signal <CPS_BMS_WakeUp> indicates that the wakeup source is not the CPS..| - | TODO B3 |
|[CCB-15086](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-15086)| The BMS shall always initialize the signal <BMS_CPS_PDO_TX1::BMS_REQ_CPSout> with the last stored value of <VAR_REQ_CPSout>| - | TODO B3|
|[CCB-15086](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-15087)| The BMS shall initialize the values for CAN signals of the messages <BMS_CPS_PDO_TX1>, <BMS_CPS_PDO_TX2>, <BMS_CPS_PDO_TX3>, <BMS_CPS_PDO_TX4> and <BMS_Heartbeat> according to the calculation instructions in table 2.| - | TODO B3 |
|[CCB-15088](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-15088)| The BMS shall initialize the output signal <BMS_CPS_WakeUp> as logical low for all wakeup sources except wakeup after reset. In case of a wakeup after reset, the output signal shall not be initialized again. | - | TODO B3 |
|[CCB-15089](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-15089)| The BMS shall set the output <BMS_CPS_WakeUp> to logical high once all CAN and output signals have been initialized. After 2s the BMS shall set the output <BMS_CPS_WakeUp> to logical low again. The edge of the signal will activate the CAN communication of the CPS.| - | TODO B3 |
|[CCB-15090](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-15090)|  The BMS must not start the CAN communication with the CPS, before the CPS CAN communication was activated (activated means <BMS_CPS_WakeUp> was set to high). and all signals have been initialized with valid data.| - | TODO B3 |
|[CCB-15091](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-15091)|  The exchange of service data between BMS and CPS shall be started once CAN communication with the CPS has been established. The BMS shall successfully read the DIDs 0x8000, 0x8001, 0x8002, 0x8003, 0x8004 and 0x8005 at least once. The data must be stored in the NVM of the BMS, whenever it changed. If no valid data is transmitted by the CPS, the stored data in the BMS must not be overwritten and the request shall be sent again after 1s.| - | TODO B3 |
|[CCB-15092](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-15092)| The exchange of service data between BMS and CPS shall be started once CAN communication with the CPS has been established. The BMS shall successfully read the DIDs 0x8000, 0x8001, 0x8002, 0x8003, 0x8004 and 0x8005 at least once. The data must be stored in the NVM of the BMS, whenever it changed. If no valid data is transmitted by the CPS, the stored data in the BMS must not be overwritten and the request shall be sent again after 1s.| - | TODO B3 |
|[CCB-15094](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-15094)|At the end of the Periodic WakeUp the BMS shall execute the “update recovery data routine”| - | TODO B3 |
|[CCB-15095](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-15095)| The “update recovery data” routine shall be aborted whenever the BMS leaves the state “Periodic WakeUp” (external event).| - | TODO B3 |
|[CCB-15098](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-15098)|  The BMS must set the variable <VAR_REQ_CPSout> to 1 in the BMS state Authentification.| - | TODO B3|
|[CCB-15100](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-15100)|The BMS must set the variable <VAR_REQ_CPSout>  to the value 0, <PARAM_DelayEnableCPSTruckOut> ms after the BMS entered the state.| - | TODO B3|
|[CCB-15102](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-15102)| TThe BMS must set the variable <VAR_REQ_CPSout>  to the value 0, <PARAM_DelayDisableCPSTruckOutEmergency> ms after the BMS entered the state, if the contactors are closed.| - | TODO B3 |
|[CCB-15104](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-15104)| The BMS must set the variable <VAR_REQ_CPSout> to 1 immediately after the BMS entered this state (at least 100ms before the contactors mechanically open).| - | TODO B3 |
|[CCB-15106](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-15106)| The variable <VAR_REQ_CPSout> represents the state of the output <External_CPSout> of the CPS within the state-machine. The variable <VAR_REQ_CPSout> must be stored in the NVM of the BMS during shutdown or reset. The variable <VAR_REQ_CPSout> is also controllable by the UDS routine 0x427.| - | TODO B3 |
|[CCB-15108](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-15108)| [BMS064] The BMS must set the signal  <VAR_REQ_CPSout> to 0 in the state KION_Shutdown and SAFT_Shutdown, whenever the BMS parameter <PARAM_Pushbutton> has the value 3 (=pusbutton built in).  In case of a “BMS reset” (by NMT, UDS etc.) the variable <VAR_REQ_CPSout> must not be set to 0.| - | TODO B3 |
|[CCB-15109](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-15109)|  [BMS062] The BMS must send at least three messages  <BMS_CPS_PDO_TX1> after updating its signals according to the requirements of the state KION_shutdown or SAFT_Shutdown, before the BMS stops the CAN communication with the CPS and all other components on the internal CAN within 100ms.| - | TODO B3 |
|[CCB-15112](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-15112)| The BMS must set the variable <VAR_REQ_CPSout>  to the value 1 and then wait for <PARAM_DelayDisableCPSTruckOutDrive> ms before the BMS starts to open any contactors. This delay is necessary so that the CPS can enable the vehicle supply.| - | TODO B3 |
|[CCB-15114](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-15114)|If a “Deep-Discharge possible” DTC is active, the BMS must set the variable <VAR_REQ_CPSout> to the value 0 in the respective shutdown state.| - | TODO B3 |
|[CCB-15116](https://polarion.futavis.de/polarion/#/project/CB_BMS/workitem?id=CB-15116)|The BMS must store all relevant data in the NVM before setting  <BMS_CPS_PDO_TX1::BMS_REQ_PowerDown> to 1.| - | TODO B3 |
